{"ast":null,"code":"/*\n * Copyright 2016 Palantir Technologies, Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { __assign, __decorate, __extends } from \"tslib\";\nimport classNames from \"classnames\";\nimport * as React from \"react\";\nimport { polyfill } from \"react-lifecycles-compat\";\nimport { AbstractPureComponent2, DISPLAYNAME_PREFIX, InputGroup, Intent, Keys, Popover, refHandler, setRef } from \"@blueprintjs/core\";\nimport * as Classes from \"./common/classes\";\nimport { isDateValid, isDayInRange } from \"./common/dateUtils\";\nimport { getFormattedDateString } from \"./dateFormat\";\nimport { DatePicker } from \"./datePicker\";\nimport { getDefaultMaxDate, getDefaultMinDate } from \"./datePickerCore\";\n\nvar DateInput =\n/** @class */\nfunction (_super) {\n  __extends(DateInput, _super);\n\n  function DateInput() {\n    var _a;\n\n    var _this = _super.apply(this, arguments) || this;\n\n    _this.state = {\n      isInputFocused: false,\n      isOpen: false,\n      value: _this.props.value !== undefined ? _this.props.value : _this.props.defaultValue,\n      valueString: null\n    };\n    _this.inputElement = null;\n    _this.popoverContentElement = null;\n    _this.handleInputRef = refHandler(_this, \"inputElement\", (_a = _this.props.inputProps) === null || _a === void 0 ? void 0 : _a.inputRef);\n    _this.handlePopoverContentRef = refHandler(_this, \"popoverContentElement\");\n\n    _this.handleClosePopover = function (e) {\n      var _a;\n\n      var _b = _this.props.popoverProps,\n          popoverProps = _b === void 0 ? {} : _b;\n      (_a = popoverProps.onClose) === null || _a === void 0 ? void 0 : _a.call(popoverProps, e);\n\n      _this.setState({\n        isOpen: false\n      });\n    };\n\n    _this.handleDateChange = function (newDate, isUserChange, didSubmitWithEnter) {\n      var _a, _b;\n\n      if (didSubmitWithEnter === void 0) {\n        didSubmitWithEnter = false;\n      }\n\n      var prevDate = _this.state.value; // this change handler was triggered by a change in month, day, or (if\n      // enabled) time. for UX purposes, we want to close the popover only if\n      // the user explicitly clicked a day within the current month.\n\n      var isOpen = !isUserChange || !_this.props.closeOnSelection || prevDate != null && (_this.hasMonthChanged(prevDate, newDate) || _this.hasTimeChanged(prevDate, newDate)); // if selecting a date via click or Tab, the input will already be\n      // blurred by now, so sync isInputFocused to false. if selecting via\n      // Enter, setting isInputFocused to false won't do anything by itself,\n      // plus we want the field to retain focus anyway.\n      // (note: spelling out the ternary explicitly reads more clearly.)\n\n\n      var isInputFocused = didSubmitWithEnter ? true : false;\n\n      if (_this.props.value === undefined) {\n        var valueString = getFormattedDateString(newDate, _this.props);\n\n        _this.setState({\n          isInputFocused: isInputFocused,\n          isOpen: isOpen,\n          value: newDate,\n          valueString: valueString\n        });\n      } else {\n        _this.setState({\n          isInputFocused: isInputFocused,\n          isOpen: isOpen\n        });\n      }\n\n      (_b = (_a = _this.props).onChange) === null || _b === void 0 ? void 0 : _b.call(_a, newDate, isUserChange);\n    };\n\n    _this.handleInputFocus = function (e) {\n      var valueString = _this.state.value == null ? \"\" : _this.formatDate(_this.state.value);\n\n      _this.setState({\n        isInputFocused: true,\n        isOpen: true,\n        valueString: valueString\n      });\n\n      _this.safeInvokeInputProp(\"onFocus\", e);\n    };\n\n    _this.handleInputClick = function (e) {\n      // stop propagation to the Popover's internal handleTargetClick handler;\n      // otherwise, the popover will flicker closed as soon as it opens.\n      e.stopPropagation();\n\n      _this.safeInvokeInputProp(\"onClick\", e);\n    };\n\n    _this.handleInputChange = function (e) {\n      var _a, _b, _c, _d;\n\n      var valueString = e.target.value;\n\n      var value = _this.parseDate(valueString);\n\n      if (isDateValid(value) && _this.isDateInRange(value)) {\n        if (_this.props.value === undefined) {\n          _this.setState({\n            value: value,\n            valueString: valueString\n          });\n        } else {\n          _this.setState({\n            valueString: valueString\n          });\n        }\n\n        (_b = (_a = _this.props).onChange) === null || _b === void 0 ? void 0 : _b.call(_a, value, true);\n      } else {\n        if (valueString.length === 0) {\n          (_d = (_c = _this.props).onChange) === null || _d === void 0 ? void 0 : _d.call(_c, null, true);\n        }\n\n        _this.setState({\n          valueString: valueString\n        });\n      }\n\n      _this.safeInvokeInputProp(\"onChange\", e);\n    };\n\n    _this.handleInputBlur = function (e) {\n      var _a, _b, _c, _d, _e, _f;\n\n      var valueString = _this.state.valueString;\n\n      var date = _this.parseDate(valueString);\n\n      if (valueString.length > 0 && valueString !== getFormattedDateString(_this.state.value, _this.props) && (!isDateValid(date) || !_this.isDateInRange(date))) {\n        if (_this.props.value === undefined) {\n          _this.setState({\n            isInputFocused: false,\n            value: date,\n            valueString: null\n          });\n        } else {\n          _this.setState({\n            isInputFocused: false\n          });\n        }\n\n        if (isNaN(date.valueOf())) {\n          (_b = (_a = _this.props).onError) === null || _b === void 0 ? void 0 : _b.call(_a, new Date(undefined));\n        } else if (!_this.isDateInRange(date)) {\n          (_d = (_c = _this.props).onError) === null || _d === void 0 ? void 0 : _d.call(_c, date);\n        } else {\n          (_f = (_e = _this.props).onChange) === null || _f === void 0 ? void 0 : _f.call(_e, date, true);\n        }\n      } else {\n        if (valueString.length === 0) {\n          _this.setState({\n            isInputFocused: false,\n            value: null,\n            valueString: null\n          });\n        } else {\n          _this.setState({\n            isInputFocused: false\n          });\n        }\n      }\n\n      _this.safeInvokeInputProp(\"onBlur\", e);\n    };\n\n    _this.handleInputKeyDown = function (e) {\n      var _a, _b; // HACKHACK: https://github.com/palantir/blueprint/issues/4165\n\n      /* eslint-disable deprecation/deprecation */\n\n\n      if (e.which === Keys.ENTER) {\n        var nextDate = _this.parseDate(_this.state.valueString);\n\n        _this.handleDateChange(nextDate, true, true);\n      } else if (e.which === Keys.TAB && e.shiftKey) {\n        // close popover on SHIFT+TAB key press\n        _this.handleClosePopover();\n      } else if (e.which === Keys.TAB && _this.state.isOpen) {\n        (_a = _this.getKeyboardFocusableElements().shift()) === null || _a === void 0 ? void 0 : _a.focus(); // necessary to prevent focusing the second focusable element\n\n        e.preventDefault();\n      } else if (e.which === Keys.ESCAPE) {\n        _this.setState({\n          isOpen: false\n        });\n\n        (_b = _this.inputElement) === null || _b === void 0 ? void 0 : _b.blur();\n      }\n\n      _this.safeInvokeInputProp(\"onKeyDown\", e);\n    };\n\n    _this.getKeyboardFocusableElements = function () {\n      var _a;\n\n      var elements = Array.from((_a = _this.popoverContentElement) === null || _a === void 0 ? void 0 : _a.querySelectorAll(\"button:not([disabled]),input,[tabindex]:not([tabindex='-1'])\")); // Remove focus boundary div elements\n\n      elements.pop();\n      elements.shift();\n      return elements;\n    };\n\n    _this.handleStartFocusBoundaryFocusIn = function (e) {\n      var _a, _b;\n\n      if (_this.popoverContentElement.contains(_this.getRelatedTarget(e))) {\n        // Not closing Popover to allow user to freely switch between manually entering a date\n        // string in the input and selecting one via the Popover\n        (_a = _this.inputElement) === null || _a === void 0 ? void 0 : _a.focus();\n      } else {\n        (_b = _this.getKeyboardFocusableElements().shift()) === null || _b === void 0 ? void 0 : _b.focus();\n      }\n    };\n\n    _this.handleEndFocusBoundaryFocusIn = function (e) {\n      var _a, _b;\n\n      if (_this.popoverContentElement.contains(_this.getRelatedTarget(e))) {\n        (_a = _this.inputElement) === null || _a === void 0 ? void 0 : _a.focus();\n\n        _this.handleClosePopover();\n      } else {\n        (_b = _this.getKeyboardFocusableElements().pop()) === null || _b === void 0 ? void 0 : _b.focus();\n      }\n    };\n\n    _this.handleShortcutChange = function (_, selectedShortcutIndex) {\n      _this.setState({\n        selectedShortcutIndex: selectedShortcutIndex\n      });\n    };\n\n    return _this;\n  }\n\n  DateInput.prototype.render = function () {\n    var _this = this;\n\n    var _a = this.state,\n        value = _a.value,\n        valueString = _a.valueString;\n    var dateString = this.state.isInputFocused ? valueString : getFormattedDateString(value, this.props);\n    var dateValue = isDateValid(value) ? value : null;\n\n    var dayPickerProps = __assign(__assign({}, this.props.dayPickerProps), {\n      onDayKeyDown: function (day, modifiers, e) {\n        var _a, _b;\n\n        (_b = (_a = _this.props.dayPickerProps).onDayKeyDown) === null || _b === void 0 ? void 0 : _b.call(_a, day, modifiers, e);\n      },\n      onMonthChange: function (month) {\n        var _a, _b;\n\n        (_b = (_a = _this.props.dayPickerProps).onMonthChange) === null || _b === void 0 ? void 0 : _b.call(_a, month);\n      }\n    }); // React's onFocus prop listens to the focusin browser event under the hood, so it's safe to\n    // provide it the focusIn event handlers instead of using a ref and manually adding the\n    // event listeners ourselves.\n\n\n    var wrappedPopoverContent = React.createElement(\"div\", {\n      ref: this.handlePopoverContentRef\n    }, React.createElement(\"div\", {\n      onFocus: this.handleStartFocusBoundaryFocusIn,\n      tabIndex: 0\n    }), React.createElement(DatePicker, __assign({}, this.props, {\n      dayPickerProps: dayPickerProps,\n      onChange: this.handleDateChange,\n      value: dateValue,\n      onShortcutChange: this.handleShortcutChange,\n      selectedShortcutIndex: this.state.selectedShortcutIndex\n    })), React.createElement(\"div\", {\n      onFocus: this.handleEndFocusBoundaryFocusIn,\n      tabIndex: 0\n    })); // assign default empty object here to prevent mutation\n\n    var _b = this.props,\n        _c = _b.inputProps,\n        inputProps = _c === void 0 ? {} : _c,\n        _d = _b.popoverProps,\n        popoverProps = _d === void 0 ? {} : _d;\n    var isErrorState = value != null && (!isDateValid(value) || !this.isDateInRange(value));\n    return (\n      /* eslint-disable-next-line deprecation/deprecation */\n      React.createElement(Popover, __assign({\n        isOpen: this.state.isOpen && !this.props.disabled,\n        fill: this.props.fill\n      }, popoverProps, {\n        autoFocus: false,\n        className: classNames(popoverProps.className, this.props.className),\n        content: wrappedPopoverContent,\n        enforceFocus: false,\n        onClose: this.handleClosePopover,\n        popoverClassName: classNames(Classes.DATEINPUT_POPOVER, popoverProps.popoverClassName)\n      }), React.createElement(InputGroup, __assign({\n        autoComplete: \"off\",\n        intent: isErrorState ? Intent.DANGER : Intent.NONE,\n        placeholder: this.props.placeholder,\n        rightElement: this.props.rightElement,\n        type: \"text\"\n      }, inputProps, {\n        disabled: this.props.disabled,\n        inputRef: this.handleInputRef,\n        onBlur: this.handleInputBlur,\n        onChange: this.handleInputChange,\n        onClick: this.handleInputClick,\n        onFocus: this.handleInputFocus,\n        onKeyDown: this.handleInputKeyDown,\n        value: dateString\n      })))\n    );\n  };\n\n  DateInput.prototype.componentDidUpdate = function (prevProps, prevState) {\n    var _a, _b, _c, _d, _e;\n\n    _super.prototype.componentDidUpdate.call(this, prevProps, prevState);\n\n    if (((_a = prevProps.inputProps) === null || _a === void 0 ? void 0 : _a.inputRef) !== ((_b = this.props.inputProps) === null || _b === void 0 ? void 0 : _b.inputRef)) {\n      setRef((_c = prevProps.inputProps) === null || _c === void 0 ? void 0 : _c.inputRef, null);\n      this.handleInputRef = refHandler(this, \"inputElement\", (_d = this.props.inputProps) === null || _d === void 0 ? void 0 : _d.inputRef);\n      setRef((_e = this.props.inputProps) === null || _e === void 0 ? void 0 : _e.inputRef, this.inputElement);\n    }\n\n    if (prevProps.value !== this.props.value) {\n      this.setState({\n        value: this.props.value\n      });\n    }\n  };\n\n  DateInput.prototype.isDateInRange = function (value) {\n    return isDayInRange(value, [this.props.minDate, this.props.maxDate]);\n  };\n\n  DateInput.prototype.hasMonthChanged = function (prevDate, nextDate) {\n    return prevDate == null !== (nextDate == null) || nextDate.getMonth() !== prevDate.getMonth();\n  };\n\n  DateInput.prototype.hasTimeChanged = function (prevDate, nextDate) {\n    if (this.props.timePrecision == null) {\n      return false;\n    }\n\n    return prevDate == null !== (nextDate == null) || nextDate.getHours() !== prevDate.getHours() || nextDate.getMinutes() !== prevDate.getMinutes() || nextDate.getSeconds() !== prevDate.getSeconds() || nextDate.getMilliseconds() !== prevDate.getMilliseconds();\n  };\n\n  DateInput.prototype.getRelatedTarget = function (e) {\n    var _a; // Support IE11 (#2924)\n\n\n    return (_a = e.relatedTarget) !== null && _a !== void 0 ? _a : document.activeElement;\n  };\n  /** safe wrapper around invoking input props event handler (prop defaults to undefined) */\n\n\n  DateInput.prototype.safeInvokeInputProp = function (name, e) {\n    var _a;\n\n    var _b = this.props.inputProps,\n        inputProps = _b === void 0 ? {} : _b;\n    (_a = inputProps[name]) === null || _a === void 0 ? void 0 : _a.call(inputProps, e);\n  };\n\n  DateInput.prototype.parseDate = function (dateString) {\n    if (dateString === this.props.outOfRangeMessage || dateString === this.props.invalidDateMessage) {\n      return null;\n    }\n\n    var _a = this.props,\n        locale = _a.locale,\n        parseDate = _a.parseDate;\n    var newDate = parseDate(dateString, locale);\n    return newDate === false ? new Date(undefined) : newDate;\n  };\n\n  DateInput.prototype.formatDate = function (date) {\n    if (!isDateValid(date) || !this.isDateInRange(date)) {\n      return \"\";\n    }\n\n    var _a = this.props,\n        locale = _a.locale,\n        formatDate = _a.formatDate;\n    return formatDate(date, locale);\n  };\n\n  DateInput.displayName = DISPLAYNAME_PREFIX + \".DateInput\";\n  DateInput.defaultProps = {\n    closeOnSelection: true,\n    dayPickerProps: {},\n    disabled: false,\n    invalidDateMessage: \"Invalid date\",\n    maxDate: getDefaultMaxDate(),\n    minDate: getDefaultMinDate(),\n    outOfRangeMessage: \"Out of range\",\n    reverseMonthAndYearMenus: false\n  };\n  DateInput = __decorate([polyfill], DateInput);\n  return DateInput;\n}(AbstractPureComponent2);\n\nexport { DateInput };","map":{"version":3,"sources":["../../src/dateInput.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/*\n * Copyright 2016 Palantir Technologies, Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { __assign, __decorate, __extends } from \"tslib\";\nimport classNames from \"classnames\";\nimport * as React from \"react\";\nimport { polyfill } from \"react-lifecycles-compat\";\nimport { AbstractPureComponent2, DISPLAYNAME_PREFIX, InputGroup, Intent, Keys, Popover, refHandler, setRef, } from \"@blueprintjs/core\";\nimport * as Classes from \"./common/classes\";\nimport { isDateValid, isDayInRange } from \"./common/dateUtils\";\nimport { getFormattedDateString } from \"./dateFormat\";\nimport { DatePicker } from \"./datePicker\";\nimport { getDefaultMaxDate, getDefaultMinDate } from \"./datePickerCore\";\nvar DateInput = /** @class */ (function (_super) {\n    __extends(DateInput, _super);\n    function DateInput() {\n        var _a;\n        var _this = _super.apply(this, arguments) || this;\n        _this.state = {\n            isInputFocused: false,\n            isOpen: false,\n            value: _this.props.value !== undefined ? _this.props.value : _this.props.defaultValue,\n            valueString: null,\n        };\n        _this.inputElement = null;\n        _this.popoverContentElement = null;\n        _this.handleInputRef = refHandler(_this, \"inputElement\", (_a = _this.props.inputProps) === null || _a === void 0 ? void 0 : _a.inputRef);\n        _this.handlePopoverContentRef = refHandler(_this, \"popoverContentElement\");\n        _this.handleClosePopover = function (e) {\n            var _a;\n            var _b = _this.props.popoverProps, popoverProps = _b === void 0 ? {} : _b;\n            (_a = popoverProps.onClose) === null || _a === void 0 ? void 0 : _a.call(popoverProps, e);\n            _this.setState({ isOpen: false });\n        };\n        _this.handleDateChange = function (newDate, isUserChange, didSubmitWithEnter) {\n            var _a, _b;\n            if (didSubmitWithEnter === void 0) { didSubmitWithEnter = false; }\n            var prevDate = _this.state.value;\n            // this change handler was triggered by a change in month, day, or (if\n            // enabled) time. for UX purposes, we want to close the popover only if\n            // the user explicitly clicked a day within the current month.\n            var isOpen = !isUserChange ||\n                !_this.props.closeOnSelection ||\n                (prevDate != null && (_this.hasMonthChanged(prevDate, newDate) || _this.hasTimeChanged(prevDate, newDate)));\n            // if selecting a date via click or Tab, the input will already be\n            // blurred by now, so sync isInputFocused to false. if selecting via\n            // Enter, setting isInputFocused to false won't do anything by itself,\n            // plus we want the field to retain focus anyway.\n            // (note: spelling out the ternary explicitly reads more clearly.)\n            var isInputFocused = didSubmitWithEnter ? true : false;\n            if (_this.props.value === undefined) {\n                var valueString = getFormattedDateString(newDate, _this.props);\n                _this.setState({ isInputFocused: isInputFocused, isOpen: isOpen, value: newDate, valueString: valueString });\n            }\n            else {\n                _this.setState({ isInputFocused: isInputFocused, isOpen: isOpen });\n            }\n            (_b = (_a = _this.props).onChange) === null || _b === void 0 ? void 0 : _b.call(_a, newDate, isUserChange);\n        };\n        _this.handleInputFocus = function (e) {\n            var valueString = _this.state.value == null ? \"\" : _this.formatDate(_this.state.value);\n            _this.setState({ isInputFocused: true, isOpen: true, valueString: valueString });\n            _this.safeInvokeInputProp(\"onFocus\", e);\n        };\n        _this.handleInputClick = function (e) {\n            // stop propagation to the Popover's internal handleTargetClick handler;\n            // otherwise, the popover will flicker closed as soon as it opens.\n            e.stopPropagation();\n            _this.safeInvokeInputProp(\"onClick\", e);\n        };\n        _this.handleInputChange = function (e) {\n            var _a, _b, _c, _d;\n            var valueString = e.target.value;\n            var value = _this.parseDate(valueString);\n            if (isDateValid(value) && _this.isDateInRange(value)) {\n                if (_this.props.value === undefined) {\n                    _this.setState({ value: value, valueString: valueString });\n                }\n                else {\n                    _this.setState({ valueString: valueString });\n                }\n                (_b = (_a = _this.props).onChange) === null || _b === void 0 ? void 0 : _b.call(_a, value, true);\n            }\n            else {\n                if (valueString.length === 0) {\n                    (_d = (_c = _this.props).onChange) === null || _d === void 0 ? void 0 : _d.call(_c, null, true);\n                }\n                _this.setState({ valueString: valueString });\n            }\n            _this.safeInvokeInputProp(\"onChange\", e);\n        };\n        _this.handleInputBlur = function (e) {\n            var _a, _b, _c, _d, _e, _f;\n            var valueString = _this.state.valueString;\n            var date = _this.parseDate(valueString);\n            if (valueString.length > 0 &&\n                valueString !== getFormattedDateString(_this.state.value, _this.props) &&\n                (!isDateValid(date) || !_this.isDateInRange(date))) {\n                if (_this.props.value === undefined) {\n                    _this.setState({ isInputFocused: false, value: date, valueString: null });\n                }\n                else {\n                    _this.setState({ isInputFocused: false });\n                }\n                if (isNaN(date.valueOf())) {\n                    (_b = (_a = _this.props).onError) === null || _b === void 0 ? void 0 : _b.call(_a, new Date(undefined));\n                }\n                else if (!_this.isDateInRange(date)) {\n                    (_d = (_c = _this.props).onError) === null || _d === void 0 ? void 0 : _d.call(_c, date);\n                }\n                else {\n                    (_f = (_e = _this.props).onChange) === null || _f === void 0 ? void 0 : _f.call(_e, date, true);\n                }\n            }\n            else {\n                if (valueString.length === 0) {\n                    _this.setState({ isInputFocused: false, value: null, valueString: null });\n                }\n                else {\n                    _this.setState({ isInputFocused: false });\n                }\n            }\n            _this.safeInvokeInputProp(\"onBlur\", e);\n        };\n        _this.handleInputKeyDown = function (e) {\n            var _a, _b;\n            // HACKHACK: https://github.com/palantir/blueprint/issues/4165\n            /* eslint-disable deprecation/deprecation */\n            if (e.which === Keys.ENTER) {\n                var nextDate = _this.parseDate(_this.state.valueString);\n                _this.handleDateChange(nextDate, true, true);\n            }\n            else if (e.which === Keys.TAB && e.shiftKey) {\n                // close popover on SHIFT+TAB key press\n                _this.handleClosePopover();\n            }\n            else if (e.which === Keys.TAB && _this.state.isOpen) {\n                (_a = _this.getKeyboardFocusableElements().shift()) === null || _a === void 0 ? void 0 : _a.focus();\n                // necessary to prevent focusing the second focusable element\n                e.preventDefault();\n            }\n            else if (e.which === Keys.ESCAPE) {\n                _this.setState({ isOpen: false });\n                (_b = _this.inputElement) === null || _b === void 0 ? void 0 : _b.blur();\n            }\n            _this.safeInvokeInputProp(\"onKeyDown\", e);\n        };\n        _this.getKeyboardFocusableElements = function () {\n            var _a;\n            var elements = Array.from((_a = _this.popoverContentElement) === null || _a === void 0 ? void 0 : _a.querySelectorAll(\"button:not([disabled]),input,[tabindex]:not([tabindex='-1'])\"));\n            // Remove focus boundary div elements\n            elements.pop();\n            elements.shift();\n            return elements;\n        };\n        _this.handleStartFocusBoundaryFocusIn = function (e) {\n            var _a, _b;\n            if (_this.popoverContentElement.contains(_this.getRelatedTarget(e))) {\n                // Not closing Popover to allow user to freely switch between manually entering a date\n                // string in the input and selecting one via the Popover\n                (_a = _this.inputElement) === null || _a === void 0 ? void 0 : _a.focus();\n            }\n            else {\n                (_b = _this.getKeyboardFocusableElements().shift()) === null || _b === void 0 ? void 0 : _b.focus();\n            }\n        };\n        _this.handleEndFocusBoundaryFocusIn = function (e) {\n            var _a, _b;\n            if (_this.popoverContentElement.contains(_this.getRelatedTarget(e))) {\n                (_a = _this.inputElement) === null || _a === void 0 ? void 0 : _a.focus();\n                _this.handleClosePopover();\n            }\n            else {\n                (_b = _this.getKeyboardFocusableElements().pop()) === null || _b === void 0 ? void 0 : _b.focus();\n            }\n        };\n        _this.handleShortcutChange = function (_, selectedShortcutIndex) {\n            _this.setState({ selectedShortcutIndex: selectedShortcutIndex });\n        };\n        return _this;\n    }\n    DateInput.prototype.render = function () {\n        var _this = this;\n        var _a = this.state, value = _a.value, valueString = _a.valueString;\n        var dateString = this.state.isInputFocused ? valueString : getFormattedDateString(value, this.props);\n        var dateValue = isDateValid(value) ? value : null;\n        var dayPickerProps = __assign(__assign({}, this.props.dayPickerProps), { onDayKeyDown: function (day, modifiers, e) {\n                var _a, _b;\n                (_b = (_a = _this.props.dayPickerProps).onDayKeyDown) === null || _b === void 0 ? void 0 : _b.call(_a, day, modifiers, e);\n            }, onMonthChange: function (month) {\n                var _a, _b;\n                (_b = (_a = _this.props.dayPickerProps).onMonthChange) === null || _b === void 0 ? void 0 : _b.call(_a, month);\n            } });\n        // React's onFocus prop listens to the focusin browser event under the hood, so it's safe to\n        // provide it the focusIn event handlers instead of using a ref and manually adding the\n        // event listeners ourselves.\n        var wrappedPopoverContent = (React.createElement(\"div\", { ref: this.handlePopoverContentRef },\n            React.createElement(\"div\", { onFocus: this.handleStartFocusBoundaryFocusIn, tabIndex: 0 }),\n            React.createElement(DatePicker, __assign({}, this.props, { dayPickerProps: dayPickerProps, onChange: this.handleDateChange, value: dateValue, onShortcutChange: this.handleShortcutChange, selectedShortcutIndex: this.state.selectedShortcutIndex })),\n            React.createElement(\"div\", { onFocus: this.handleEndFocusBoundaryFocusIn, tabIndex: 0 })));\n        // assign default empty object here to prevent mutation\n        var _b = this.props, _c = _b.inputProps, inputProps = _c === void 0 ? {} : _c, _d = _b.popoverProps, popoverProps = _d === void 0 ? {} : _d;\n        var isErrorState = value != null && (!isDateValid(value) || !this.isDateInRange(value));\n        return (\n        /* eslint-disable-next-line deprecation/deprecation */\n        React.createElement(Popover, __assign({ isOpen: this.state.isOpen && !this.props.disabled, fill: this.props.fill }, popoverProps, { autoFocus: false, className: classNames(popoverProps.className, this.props.className), content: wrappedPopoverContent, enforceFocus: false, onClose: this.handleClosePopover, popoverClassName: classNames(Classes.DATEINPUT_POPOVER, popoverProps.popoverClassName) }),\n            React.createElement(InputGroup, __assign({ autoComplete: \"off\", intent: isErrorState ? Intent.DANGER : Intent.NONE, placeholder: this.props.placeholder, rightElement: this.props.rightElement, type: \"text\" }, inputProps, { disabled: this.props.disabled, inputRef: this.handleInputRef, onBlur: this.handleInputBlur, onChange: this.handleInputChange, onClick: this.handleInputClick, onFocus: this.handleInputFocus, onKeyDown: this.handleInputKeyDown, value: dateString }))));\n    };\n    DateInput.prototype.componentDidUpdate = function (prevProps, prevState) {\n        var _a, _b, _c, _d, _e;\n        _super.prototype.componentDidUpdate.call(this, prevProps, prevState);\n        if (((_a = prevProps.inputProps) === null || _a === void 0 ? void 0 : _a.inputRef) !== ((_b = this.props.inputProps) === null || _b === void 0 ? void 0 : _b.inputRef)) {\n            setRef((_c = prevProps.inputProps) === null || _c === void 0 ? void 0 : _c.inputRef, null);\n            this.handleInputRef = refHandler(this, \"inputElement\", (_d = this.props.inputProps) === null || _d === void 0 ? void 0 : _d.inputRef);\n            setRef((_e = this.props.inputProps) === null || _e === void 0 ? void 0 : _e.inputRef, this.inputElement);\n        }\n        if (prevProps.value !== this.props.value) {\n            this.setState({ value: this.props.value });\n        }\n    };\n    DateInput.prototype.isDateInRange = function (value) {\n        return isDayInRange(value, [this.props.minDate, this.props.maxDate]);\n    };\n    DateInput.prototype.hasMonthChanged = function (prevDate, nextDate) {\n        return (prevDate == null) !== (nextDate == null) || nextDate.getMonth() !== prevDate.getMonth();\n    };\n    DateInput.prototype.hasTimeChanged = function (prevDate, nextDate) {\n        if (this.props.timePrecision == null) {\n            return false;\n        }\n        return ((prevDate == null) !== (nextDate == null) ||\n            nextDate.getHours() !== prevDate.getHours() ||\n            nextDate.getMinutes() !== prevDate.getMinutes() ||\n            nextDate.getSeconds() !== prevDate.getSeconds() ||\n            nextDate.getMilliseconds() !== prevDate.getMilliseconds());\n    };\n    DateInput.prototype.getRelatedTarget = function (e) {\n        var _a;\n        // Support IE11 (#2924)\n        return ((_a = e.relatedTarget) !== null && _a !== void 0 ? _a : document.activeElement);\n    };\n    /** safe wrapper around invoking input props event handler (prop defaults to undefined) */\n    DateInput.prototype.safeInvokeInputProp = function (name, e) {\n        var _a;\n        var _b = this.props.inputProps, inputProps = _b === void 0 ? {} : _b;\n        (_a = inputProps[name]) === null || _a === void 0 ? void 0 : _a.call(inputProps, e);\n    };\n    DateInput.prototype.parseDate = function (dateString) {\n        if (dateString === this.props.outOfRangeMessage || dateString === this.props.invalidDateMessage) {\n            return null;\n        }\n        var _a = this.props, locale = _a.locale, parseDate = _a.parseDate;\n        var newDate = parseDate(dateString, locale);\n        return newDate === false ? new Date(undefined) : newDate;\n    };\n    DateInput.prototype.formatDate = function (date) {\n        if (!isDateValid(date) || !this.isDateInRange(date)) {\n            return \"\";\n        }\n        var _a = this.props, locale = _a.locale, formatDate = _a.formatDate;\n        return formatDate(date, locale);\n    };\n    DateInput.displayName = DISPLAYNAME_PREFIX + \".DateInput\";\n    DateInput.defaultProps = {\n        closeOnSelection: true,\n        dayPickerProps: {},\n        disabled: false,\n        invalidDateMessage: \"Invalid date\",\n        maxDate: getDefaultMaxDate(),\n        minDate: getDefaultMinDate(),\n        outOfRangeMessage: \"Out of range\",\n        reverseMonthAndYearMenus: false,\n    };\n    DateInput = __decorate([\n        polyfill\n    ], DateInput);\n    return DateInput;\n}(AbstractPureComponent2));\nexport { DateInput };\n//# sourceMappingURL=dateInput.js.map"]},"metadata":{},"sourceType":"module"}